!async function(){const e=window.__lvlUpOverlay||(alert("Overlay helpers not loaded"),{}),t=["createOverlay","ce","txt","style","clearEl","chunk","sanitizeGuid","guidPathValue","guidLiteral","escapeODataValue","downloadFile"].filter((t=>"function"!=typeof e[t]));if(t.length)return void alert("Overlay helpers missing: "+t.join(", ")+". Please load helperOverlayV2.js first.");const r=e.createOverlay,o=e.ce,n=e.txt,s=e.style,a=e.clearEl,i=e.chunk,d=e.sanitizeGuid,l=e.guidPathValue,c=e.guidLiteral,p=(e.escapeODataValue,e.downloadFile,{light:{primary:"#0078d4",primaryHover:"#106ebe",border:"#ddd",borderLight:"#eee",text:"#323130",textMuted:"#605e5c",textError:"#a80000",bg:"#fff",bgHover:"#f3f2f1",bgError:"#fde7e9",textOnPrimary:"#fff",success:"#107c10",successHover:"#0e6b0e",danger:"#d13438",dangerHover:"#a80000"},dark:{primary:"#60a5fa",primaryHover:"#3b82f6",border:"#374151",borderLight:"#4b5563",text:"#eef2ff",textMuted:"#9ca3af",textError:"#fca5a5",bg:"#1f2937",bgHover:"#374151",bgError:"#7f1d1d",textOnPrimary:"#fff",success:"#10b981",successHover:"#059669",danger:"#ef4444",dangerHover:"#dc2626"}});let u=null;try{const e=localStorage.getItem("crmab-securityroleanalyzer-colors");e&&(u=JSON.parse(e))}catch(e){}const m=r("Security Role Analyzer - Single User",{rootId:"crmab-securityroleanalyzer-single",width:1e3,maxHeight:"95vh",footer:!0,footerText:"Ready"});if(!m||!m.body)return;let g=[];const x=(e,t)=>{g.push({timestamp:new Date,message:e,type:t||"info"}),g.length>100&&g.shift()};m.body.style.minHeight="700px",m.body.style.maxHeight="90vh",m.body.style.overflowY="auto",m.body.style.paddingBottom="20px";const y=(()=>{const e="dark"===m.host.getAttribute("data-theme")?"dark":"light";return u&&u[e]||p[e]})();try{const e=Xrm.Utility.getGlobalContext(),t=e.getClientUrl()+"/api/data/v9.2",h=e.getClientUrl(),f={"OData-MaxVersion":"4.0","OData-Version":"4.0",Accept:"application/json","Content-Type":"application/json"},b=String.fromCharCode(39);let v=null;const C=async()=>{if(v)return v;try{const e=await w("/organizations?$select=organizationid");if(e.value&&e.value.length>0)return v=e.value[0].organizationid,x("Environment ID retrieved from organization table","info"),v}catch(e){console.warn("Failed to retrieve environment ID from organization table:",e)}try{const e=new URL(h).hostname.match(/([a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12})/i);if(e)return v=e[1],x("Environment ID extracted from URL","info"),v}catch(e){console.warn("Failed to extract environment ID from URL:",e)}return x("Could not determine environment ID","warning"),null},E=(e,t,r,s)=>{const a=n(o("a"),e);return a.href=`${h}/main.aspx?etn=${t}&id=${r}&newWindow=true&pagetype=entityrecord`,a.target="_blank",a.title=s||"Open record",a.style.cssText=`color:${y.primary};text-decoration:none;cursor:pointer;`,a.addEventListener("mouseenter",(function(){this.style.textDecoration="underline"})),a.addEventListener("mouseleave",(function(){this.style.textDecoration="none"})),a},w=async e=>{const r={};r.headers=f;const o=await fetch(t+e,r);if(!o.ok)throw new Error("HTTP "+o.status);return o.json()},$=async(e,t)=>{try{return await e()}catch(e){if(!t)throw e;return t()}},k=(e,t,r=null)=>{a(e);const i=r||y.textMuted;e.appendChild(n(s(o("div"),"padding:12px;color:"+i+";"),t))},L=e=>{m.updateFooter&&m.updateFooter(e),x(e,"info")};let T=[],R=[],D=[],S=null;const O=s(o("div"),"display:flex;gap:12px;margin-bottom:12px;"),z=s(o("div"),"position:relative;flex:2;"),A=s(o("input"),`width:100%;padding:8px;border:1px solid ${y.border};border-radius:4px;box-sizing:border-box;background:${y.bg};color:${y.text};`);A.type="text",A.placeholder="Type to filter users...";const H=s(o("div"),`display:none;position:absolute;top:100%;left:0;right:0;min-height:350px;max-height:650px;overflow-y:auto;border:1px solid ${y.border};border-radius:4px;background:${y.bg};z-index:1000;box-shadow:0 4px 8px rgba(0,0,0,0.1);`);z.appendChild(A),z.appendChild(H);const I=s(o("div"),"position:relative;flex:1;"),U=s(o("select"),`width:100%;padding:8px;border:1px solid ${y.border};border-radius:4px;background:${y.bg};color:${y.text};cursor:pointer;`),M=n(o("option"),"All Users");M.value="",U.appendChild(M),I.appendChild(U),O.appendChild(z),O.appendChild(I);const j=s(o("div"),"margin-bottom:12px;display:flex;gap:8px;flex-wrap:wrap;"),P=(e,t,r)=>{const s=n(o("button"),r+" "+e);return s.style.cssText=`padding:6px 12px;background:transparent;color:${y.text};border:1px solid ${y.border};border-radius:4px;cursor:pointer;font-size:11px;font-weight:600;`,s.addEventListener("mouseenter",(function(){this.style.background=y.bgHover})),s.addEventListener("mouseleave",(function(){this.style.background="transparent"})),s.addEventListener("click",(()=>{window.open(t,"_blank"),x("Opened: "+e,"info")})),s};j.appendChild(P("All Security Roles",`${h}/main.aspx?pagetype=entitylist&etn=role`,"ðŸ“‹")),j.appendChild(P("Advanced Find: Users",`${h}/main.aspx?pagetype=advancedfind&etn=systemuser`,"ðŸ”")),C().then((e=>{e&&(j.insertBefore(P("Admin: Users",`https://admin.powerplatform.microsoft.com/environments/${e}/settings/users`,"ðŸ‘¥"),j.firstChild),j.insertBefore(P("Admin: Security Roles",`https://admin.powerplatform.microsoft.com/environments/${e}/settings/security/roles`,"ðŸ”"),j.firstChild))})).catch((e=>console.warn("Failed to add admin links:",e)));const N=s(o("div"),"margin-bottom:16px;display:flex;gap:8px;"),q=n(o("button"),"Reload Users");q.style.cssText=`padding:8px 16px;background:${y.primary};color:${y.textOnPrimary};border:none;border-radius:4px;cursor:pointer;flex:1;`,q.addEventListener("mouseenter",(function(){this.style.background=y.primaryHover})),q.addEventListener("mouseleave",(function(){this.style.background=y.primary}));const F=n(o("button"),"Analyze Selected User");F.style.cssText=`padding:8px 16px;background:${y.success};color:${y.textOnPrimary};border:none;border-radius:4px;cursor:pointer;flex:2;`,F.addEventListener("mouseenter",(function(){this.disabled||(this.style.background=y.successHover)})),F.addEventListener("mouseleave",(function(){this.disabled||(this.style.background=y.success)})),F.disabled=!0,N.appendChild(q),N.appendChild(F);const V=s(o("div"),"margin-top:16px;");m.body.appendChild(O),m.body.appendChild(N),m.body.appendChild(V);let B=null;const _=()=>{H.style.display="block"},J=()=>{H.style.display="none"},X=e=>{if(a(H),0!==e.length)e.forEach((e=>{const t=s(o("div"),`padding:8px 12px;cursor:pointer;border-bottom:1px solid ${y.borderLight};color:${y.text};`),r=(e.fullname||"")+(e.domainname?" ("+e.domainname+")":"");t.textContent=r,t.addEventListener("mouseenter",(()=>{t.style.background=y.bgHover})),t.addEventListener("mouseleave",(()=>{t.style.background=""})),t.addEventListener("mousedown",(t=>{t.preventDefault(),B=e,A.value=r,F.disabled=!1,J()})),H.appendChild(t)}));else{const e=n(s(o("div"),`padding:12px;color:${y.textMuted};`),"No users found");H.appendChild(e)}},G=()=>{const e=(A.value||"").trim().toLowerCase();R=0===e.length?T:T.filter((t=>{const r=(t.fullname||"").toLowerCase(),o=(t.domainname||"").toLowerCase();return r.includes(e)||o.includes(e)})),X(R),_()},W=async()=>{try{q.disabled=!0,q.textContent="Loading...",a(V),k(V,"Loading users...",y.primary);let e=[];if(S){e=(await Y("systemuser",S)).map((e=>({systemuserid:e.systemuserid,fullname:e.fullname||"",domainname:e.domainname||""})))}else{e=(await Xrm.WebApi.online.retrieveMultipleRecords("systemuser","?$select=systemuserid,fullname,domainname&$orderby=fullname asc&$top=5000")).entities||[]}T=e,R=T,A.value="",B=null,F.disabled=!0,a(V),L("Users loaded: "+T.length)}catch(e){k(V,"Error loading users: "+(e.message||e),y.textError)}finally{q.disabled=!1,q.textContent="Reload Users"}},Y=async(e,t)=>{const r=[];let o="?fetchXml="+encodeURIComponent(t),n=await Xrm.WebApi.retrieveMultipleRecords(e,o);r.push(...n.entities||[]);let s=n.nextLink||n["@odata.nextLink"];for(;s;)n=await Xrm.WebApi.retrieveMultipleRecords(e,s),r.push(...n.entities||[]),s=n.nextLink||n["@odata.nextLink"];return r},Z=async()=>{try{const e=await w("/savedqueries?$select=savedqueryid,name,fetchxml&$filter=returnedtypecode eq "+b+"systemuser"+b+" and querytype eq 0&$orderby=name asc");D=e.value||[],D.forEach((e=>{const t=n(o("option"),e.name||e.savedqueryid);t.value=e.savedqueryid,t.dataset.fetchxml=e.fetchxml||"",U.appendChild(t)})),x("Loaded "+D.length+" system user views","info")}catch(e){console.error("Error loading views:",e),x("Error loading views: "+(e.message||e),"error")}};U.addEventListener("change",(()=>{const e=U.options[U.selectedIndex];e.value?(S=e.dataset.fetchxml,x("Selected view: "+e.textContent,"info")):(S=null,x("Showing all users","info")),W()})),A.addEventListener("input",G),A.addEventListener("focus",(()=>{T.length>0&&G()})),A.addEventListener("blur",J),q.addEventListener("click",W),F.addEventListener("click",(async()=>{if(B){const e=(B.fullname||"")+(B.domainname?" ("+B.domainname+")":"");k(V,"Loading roles...",y.primary),await async function(e,t,r){try{const p=l(e);if(!p)return void k(r,"Invalid systemuser identifier.",y.textError);a(r);const u=s(o("div"),"font-weight:600;margin-bottom:8px;font-size:14px;");u.appendChild(n(o("span"),"Security Roles for: ")),u.appendChild(E(t,"systemuser",p,"Open user record in Dynamics 365")),r.appendChild(u);const m=await async function(e){const t=l(e);if(!t){const e={directRoleIds:[],teamRoleIds:[]};return e}const r=c(e),o=await $((()=>w("/systemusers("+t+")/systemuserroles_association?$select=roleid")),(()=>w("/systemuserroles?$select=roleid&$filter=systemuserid eq "+r))),n=(o.value||[]).map((e=>d(e.roleid))).filter((e=>e)),s=await $((()=>w("/systemusers("+t+")/teammembership_association?$select=teamid")),(()=>w("/teammembership?$select=teamid&$filter=systemuserid eq "+r))),a=(s.value||[]).map((e=>d(e.teamid))).filter((e=>e)),i=[];if(a.length>0){const e=await async function(e){return $((async()=>{const t=await Promise.all(e.map((e=>w("/teams("+e+")/teamroles_association?$select=roleid")))),r={};return r.value=t.flatMap((e=>e.value||[])),r}),(()=>w("/teamroles?$select=roleid&$filter="+e.map((e=>"teamid eq "+c(e))).join(" or "))))}(a.map(l));(e.value||[]).forEach((e=>{const t=d(e.roleid);t&&i.push(t)}))}const p={};return p.directRoleIds=n,p.teamRoleIds=i,p}(p),g=m.directRoleIds,h=m.teamRoleIds,f=Array.from(new Set(g.concat(h))),b=await async function(e){const t=new Map;if(0===e.length)return t;for(const r of i(e.map(l),20)){((await w("/roles?$select=roleid,name&$filter="+r.map((e=>"roleid eq "+c(e))).join(" or "))).value||[]).forEach((e=>{t.set(d(e.roleid),e.name||"")}))}return t}(f);if(0===f.length)return k(r,"No roles assigned."),void L("Roles: 0");const v=o("table");v.style.cssText="width:100%;border-collapse:collapse;font-size:12px;margin-top:8px;";const T=o("tr");["Role Name","Assignment Type"].forEach((e=>{const t=n(o("th"),e);t.style.cssText=`padding:8px;text-align:left;border-bottom:2px solid ${y.border};font-weight:600;background:${y.bgHover};color:${y.text};`,T.appendChild(t)}));const R=o("thead");R.appendChild(T),v.appendChild(R);const D=o("tbody"),S=new Set(g),O=new Set(h);f.sort(((e,t)=>(b.get(e)||"").localeCompare(b.get(t)||""))).forEach((async e=>{const t=o("tr"),r=o("td"),s=await C();if(s){const t=n(o("a"),b.get(e)||e);t.href=`https://admin.powerplatform.microsoft.com/settingredirect/${s}/securityroles/${e}/roleeditor`,t.target="_blank",t.title="Open security role in Power Platform Admin Center",t.style.cssText=`color:${y.primary};text-decoration:none;cursor:pointer;`,t.addEventListener("mouseenter",(function(){this.style.textDecoration="underline"})),t.addEventListener("mouseleave",(function(){this.style.textDecoration="none"})),r.appendChild(t)}else r.appendChild(n(o("span"),b.get(e)||e));r.style.cssText=`padding:6px 8px;border-bottom:1px solid ${y.borderLight};`;const a=[],i=S.has(e),d=O.has(e);i&&d?a.push("D, T"):i?a.push("D"):d&&a.push("T");const l=n(o("td"),a.join(""));l.style.cssText=`padding:6px 8px;border-bottom:1px solid ${y.borderLight};color:${y.text};`,l.title=i&&d?"Direct and Team assignment":i?"Direct assignment":"Team assignment",t.appendChild(r),t.appendChild(l),D.appendChild(t)})),v.appendChild(D),r.appendChild(v),function(e,t,r,a,i,d){const l=s(o("div"),"margin-top:16px;display:flex;gap:8px;justify-content:flex-end;"),c=(e,t,r)=>{const s=n(o("button"),e);return s.style.cssText=`padding:8px 16px;background:${t};color:${y.textOnPrimary};border:none;border-radius:4px;cursor:pointer;font-weight:600;font-size:12px;`,s.addEventListener("mouseenter",(function(){this.style.opacity="0.8"})),s.addEventListener("mouseleave",(function(){this.style.opacity="1"})),s.addEventListener("click",r),s},p=(e,t,r)=>{const n=new Blob([e],{type:r}),s=URL.createObjectURL(n),a=o("a");a.href=s,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s)},u=()=>{const o=t.slice().sort(((e,t)=>(i.get(e)||"").localeCompare(i.get(t)||"")));let n="User,Role Name,Assignment Type\n";o.forEach((t=>{const o=i.get(t)||t,s=r.has(t),d=a.has(t);let l="";s&&d?l="D, T":s?l="D":d&&(l="T"),n+='"'+e.replace(/"/g,'""')+'",',n+='"'+o.replace(/"/g,'""')+'",',n+=l+"\n"})),p(n,"security-roles-"+e.replace(/[^a-z0-9]/gi,"-")+".csv","text/csv;charset=utf-8;"),L("Exported to CSV"),x("Exported roles to CSV for "+e,"info")},m=()=>{const o=[];t.forEach((e=>{const t=r.has(e),n=a.has(e);let s="";t&&n?s="D, T":t?s="D":n&&(s="T"),o.push({roleId:e,roleName:i.get(e)||e,assignmentType:s,isDirect:t,isTeam:n})}));const n={exportDate:(new Date).toISOString(),user:e,totalRoles:t.length,directRoles:Array.from(r).length,teamRoles:Array.from(a).length,roles:o.sort(((e,t)=>e.roleName.localeCompare(t.roleName)))};p(JSON.stringify(n,null,2),"security-roles-"+e.replace(/[^a-z0-9]/gi,"-")+".json","application/json"),L("Exported to JSON"),x("Exported roles to JSON for "+e,"info")},g=()=>{const o=t.slice().sort(((e,t)=>(i.get(e)||"").localeCompare(i.get(t)||"")));let n="# Security Roles Report\n\n";n+="**User:** "+e+"\n\n",n+="**Generated:** "+(new Date).toLocaleString()+"\n\n",n+="## Legend\n\n",n+="- **D**: Direct assignment\n",n+="- **T**: Team assignment\n",n+="- **D, T**: Both direct and team assignment\n\n",n+="## Roles Summary\n\n",n+="- Total Roles: "+t.length+"\n",n+="- Direct Assignments: "+Array.from(r).length+"\n",n+="- Team Assignments: "+Array.from(a).length+"\n\n",n+="## Role Details\n\n",n+="| Role Name | Assignment Type |\n",n+="|-----------|----------------|\n",o.forEach((e=>{const t=i.get(e)||e,o=r.has(e),s=a.has(e);let d="";o&&s?d="D, T":o?d="D":s&&(d="T"),n+="| "+t+" | "+d+" |\n"})),p(n,"security-roles-"+e.replace(/[^a-z0-9]/gi,"-")+".md","text/markdown;charset=utf-8;"),L("Exported to Markdown"),x("Exported roles to Markdown for "+e,"info")};l.appendChild(c("ðŸ“„ Export CSV",y.success,u)),l.appendChild(c("ðŸ“‹ Export JSON",y.primary,m)),l.appendChild(c("ðŸ“ Export MD","#5c2d91",g)),d.appendChild(l)}(t,f,S,O,b,r),L("Roles: "+f.length+" ("+g.length+" direct, "+h.length+" via teams)")}catch(e){k(r,"Error loading roles: "+(e.message||e),y.textError)}}(B.systemuserid,e,V)}})),Z(),W();const K=()=>{const e=r("Color Settings",{rootId:"crmab-securityroleanalyzer-settings",width:700,maxHeight:"90vh",footer:!1});if(!e||!e.body)return;const t=e.body;t.style.cssText="padding:16px;max-height:80vh;overflow-y:auto;";const s=o("div");s.style.cssText="display:flex;gap:8px;margin-bottom:16px;border-bottom:2px solid "+y.border+";";let i="light";const d=n(o("button"),"Light Mode");d.style.cssText=`padding:8px 16px;background:transparent;border:none;border-bottom:2px solid ${y.primary};color:${y.primary};cursor:pointer;font-weight:600;`;const l=n(o("button"),"Dark Mode");l.style.cssText=`padding:8px 16px;background:transparent;border:none;border-bottom:2px solid transparent;color:${y.textMuted};cursor:pointer;font-weight:600;`;const c=o("div");c.style.cssText="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px;";const m=e=>{a(c);const t=u&&u[e]||p[e];Object.keys(p[e]).forEach((e=>{const r=o("div");r.style.cssText="display:flex;flex-direction:column;gap:4px;";const s=n(o("label"),e.replace(/([A-Z])/g," $1").trim());s.style.cssText=`font-size:12px;font-weight:600;color:${y.text};`;const a=o("div");a.style.cssText="display:flex;gap:8px;align-items:center;";const i=o("input");i.type="text",i.value=t[e],i.style.cssText=`flex:1;padding:6px;border:1px solid ${y.border};border-radius:4px;font-family:monospace;font-size:12px;background:${y.bg};color:${y.text};`;const d=o("div");d.style.cssText=`width:32px;height:32px;border:1px solid ${y.border};border-radius:4px;background:${t[e]};`,i.addEventListener("input",(()=>{d.style.background=i.value})),a.appendChild(i),a.appendChild(d),r.appendChild(s),r.appendChild(a),r.dataset.key=e,c.appendChild(r)}))},g=e=>{i=e,"light"===e?(d.style.borderBottomColor=y.primary,d.style.color=y.primary,l.style.borderBottomColor="transparent",l.style.color=y.textMuted):(l.style.borderBottomColor=y.primary,l.style.color=y.primary,d.style.borderBottomColor="transparent",d.style.color=y.textMuted),m(e)};d.addEventListener("click",(()=>g("light"))),l.addEventListener("click",(()=>g("dark"))),s.appendChild(d),s.appendChild(l),t.appendChild(s),t.appendChild(c),m("light");const h=o("div");h.style.cssText="display:flex;gap:8px;justify-content:flex-end;margin-top:16px;";const f=n(o("button"),"Save");f.style.cssText=`padding:8px 16px;background:${y.success};color:${y.textOnPrimary};border:none;border-radius:4px;cursor:pointer;font-weight:600;`,f.addEventListener("mouseenter",(function(){this.style.background=y.successHover})),f.addEventListener("mouseleave",(function(){this.style.background=y.success})),f.addEventListener("click",(()=>{const t={light:{},dark:{}};["light","dark"].forEach((e=>{g(e),Array.from(c.children).forEach((r=>{const o=r.dataset.key,n=r.querySelector("input");t[e][o]=n.value}))}));try{localStorage.setItem("crmab-securityroleanalyzer-colors",JSON.stringify(t)),x("Color settings saved","info"),e.host&&e.host.remove(),requestAnimationFrame((()=>location.reload()))}catch(e){alert("Error saving settings: "+e.message)}}));const b=n(o("button"),"Reset to Defaults");b.style.cssText=`padding:8px 16px;background:${y.danger};color:${y.textOnPrimary};border:none;border-radius:4px;cursor:pointer;font-weight:600;`,b.addEventListener("mouseenter",(function(){this.style.background=y.dangerHover})),b.addEventListener("mouseleave",(function(){this.style.background=y.danger})),b.addEventListener("click",(()=>{if(confirm("Reset all colors to defaults?"))try{localStorage.removeItem("crmab-securityroleanalyzer-colors"),x("Color settings reset to defaults","info"),e.host&&e.host.remove(),requestAnimationFrame((()=>location.reload()))}catch(e){alert("Error resetting settings: "+e.message)}}));const v=n(o("button"),"Cancel");v.style.cssText=`padding:8px 16px;background:transparent;color:${y.text};border:1px solid ${y.border};border-radius:4px;cursor:pointer;font-weight:600;`,v.addEventListener("mouseenter",(function(){this.style.background=y.bgHover})),v.addEventListener("mouseleave",(function(){this.style.background="transparent"})),v.addEventListener("click",(()=>{e.host&&e.host.remove()})),h.appendChild(v),h.appendChild(b),h.appendChild(f),t.appendChild(h)},Q=()=>{const e=r("Activity Logs",{rootId:"crmab-securityroleanalyzer-logs",width:800,maxHeight:"90vh",footer:!1});if(!e||!e.body)return;const t=e.body;t.style.cssText="padding:16px;max-height:80vh;overflow-y:auto;";const s=o("div");s.style.cssText="display:flex;justify-content:flex-end;align-items:center;margin-bottom:16px;";const a=n(o("button"),"Clear Logs");a.style.cssText=`padding:6px 12px;background:${y.danger};color:${y.textOnPrimary};border:none;border-radius:4px;cursor:pointer;font-weight:600;font-size:12px;`,a.addEventListener("mouseenter",(function(){this.style.background=y.dangerHover})),a.addEventListener("mouseleave",(function(){this.style.background=y.danger})),a.addEventListener("click",(()=>{confirm("Clear all activity logs?")&&(g=[],e.host&&e.host.remove())})),s.appendChild(a),t.appendChild(s);const i=o("div");if(i.style.cssText=`max-height:500px;overflow-y:auto;border:1px solid ${y.border};border-radius:4px;padding:12px;background:${y.bgHover};`,0===g.length){const e=n(o("div"),"No activity logs yet");e.style.cssText=`color:${y.textMuted};text-align:center;padding:20px;`,i.appendChild(e)}else g.slice().reverse().forEach((e=>{const t=o("div");t.style.cssText=`padding:8px;border-bottom:1px solid ${y.borderLight};font-size:12px;`;const r=n(o("span"),e.timestamp.toLocaleString()+" - ");r.style.cssText=`color:${y.textMuted};font-weight:600;`;const s=n(o("span"),e.message);s.style.cssText="error"===e.type?`color:${y.textError};`:`color:${y.text};`,t.appendChild(r),t.appendChild(s),i.appendChild(t)}));t.appendChild(i);const d=n(o("button"),"Close");d.style.cssText=`margin-top:16px;padding:8px 16px;background:${y.primary};color:${y.textOnPrimary};border:none;border-radius:4px;cursor:pointer;font-weight:600;width:100%;`,d.addEventListener("mouseenter",(function(){this.style.background=y.primaryHover})),d.addEventListener("mouseleave",(function(){this.style.background=y.primary})),d.addEventListener("click",(()=>{e.host&&e.host.remove()})),t.appendChild(d)},ee=n(o("button"),String.fromCharCode(9881)+" Settings");ee.style.cssText=`background:transparent;border:1px solid ${y.border};color:${y.text};padding:6px 12px;border-radius:4px;cursor:pointer;font-weight:600;font-size:12px;margin-left:8px;`,ee.addEventListener("mouseenter",(function(){this.style.background=y.bgHover})),ee.addEventListener("mouseleave",(function(){this.style.background="transparent"})),ee.addEventListener("click",K);const te=n(o("button"),String.fromCharCode(128276)+" Logs");te.style.cssText=`background:transparent;border:1px solid ${y.border};color:${y.text};padding:6px 12px;border-radius:4px;cursor:pointer;font-weight:600;font-size:12px;margin-left:8px;`,te.addEventListener("mouseenter",(function(){this.style.background=y.bgHover})),te.addEventListener("mouseleave",(function(){this.style.background="transparent"})),te.addEventListener("click",Q),m.footer&&(m.footer.appendChild(ee),m.footer.appendChild(te))}catch(e){console.error(e);const t=document.createElement("div");t.style.cssText="color:#a80000;margin-top:8px;padding:12px;",t.textContent="Error: "+(e.message||e),m.body&&m.body.appendChild(t)}}();